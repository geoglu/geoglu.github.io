<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sentiment Analysis (standalone version)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .left-container {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 45%;
    }

    #chart-sentiment, #chart-bar {
      width: 95%;
      height: 250px;
      background: #f0f0f0;
      border: 1px solid #ccc;
    }

    #map {
      width: 100%;
      height: 500px;
      border: 1px solid #ccc;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      cursor: pointer;
    }

    table, th, td {
      border: 1px solid #ccc;
    }

    th, td {
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f4f4f4;
    }

    tbody tr:hover {
      background-color: #f1f1f1;
    }

    /* Modal popup styling */
    .modal {
      display: none;
      position: fixed;
      z-index: 3000;
      padding-top: 100px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
      background-color: #fff;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 50%;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    #about-button {
      margin-bottom: 10px;
      padding: 8px 16px;
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    #about-button:hover {
      background-color: #0056b3;
    }
  </style>

  <!-- Libraries -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <h1>Sentiment analysis towards redlining practices in U.S. counties</h1>
  <h2>Based on tweets related to redlining practices</h2>
  <button id="about-button">About</button>

  <!-- About Modal -->
  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>About this App</h3>
      <p>This webapp tried to provide people with a chance to better understand public perspective towards this historical legacy
        using social media data. Two main groups are targeting audience for this webapp. The first group is the people who are 
        interested in the long-standing impact of historical housing policies in the U.S., especially for redlining practices 
        starting 1930s. This research detects public awareness on housing segregation and housing inequity. The second group is 
        people who are interested in social media data and sentiment analysis. Since tweets were used to represent public 
        perspective in this research, those people who are interested can integrate other social media data such as Facebook 
        to improve this research and related webapp. And this dashboard includes:
        <ul>
          <li>A pie chart summarizing overall sentiment distribution (Negative, Positive, Neutral).</li>
          <li>A bar chart grouping counties by negative sentiment levels.</li>
          <li>A map with interactive markers showing negative sentiment percentage for each county.</li>
          <li>A sortable table listing sentiment percentage by county.</li>
        </ul>
      </p>
      <h3>About the team</h3>
      <p>Team member: <a href="https://geoglu.github.io/" target="_blank">Yujian Lu</a> (yujianlu@unm.edu)</p>
      <p>Project advisor: <a href="https://www.lipingyang.org/" target="_blank">Liping Yang</a></p>
      <h3>Acknowledgements</h3>
      <p>The data (Tweets) were collected from:  <a href="https://developer.x.com/en" target="_blank">X</a></p>
      <p>This web app referenced: <a href="https://leafletjs.com/" target="_blank">Leaflet</a>, 
        <a href="https://www.w3schools.com/bootstrap/tryit.asp?filename=trybs_modal&stacked=h" target="_blank">Bootstrap modal plugin</a>, 
      and <a href="https://gist.github.com/michellechandra/0b2ce4923dc9b5809922" target="_blank">Michellechandra's map</a></p>
    </div>
  </div>

  <!-- Search Filter -->
  <label for="searchFilter">Search County: </label>
  <input type="text" id="searchFilter" placeholder="Filter by county..." onkeyup="filterData()">

  <!-- Main layout -->
  <div class="container">
    <div class="left-container">
      <div id="chart-sentiment">
        <canvas id="sentimentPieChart"></canvas>
      </div>
      <div id="chart-bar">
        <canvas id="negativeBarChart"></canvas>
      </div>
    </div>
    <div id="map"></div>
  </div>

  <!-- Table -->
  <h3>Counties and their sentiment analysis results table (Click headers to sort)</h3>
  <table id="sentiment-table">
    <thead>
      <tr>
        <th data-sort="County">County</th>
        <th data-sort="Negative">Negative</th>
        <th data-sort="Positive">Positive</th>
        <th data-sort="Neutral">Neutral</th>
      </tr>
    </thead>
    <tbody id="data-table-body"></tbody>
  </table>

  <script>
    const data = [
    {
      "FIPS": 48095,
      "County": "Concho County, Texas",
      "Negative": 0.56,
      "Positive": 0.06,
      "Neutral": 0.38,
      "X": -99.86394381,
      "Y": 31.32674648,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 55073,
      "County": "Marathon County, Wisconsin",
      "Negative": 0.31,
      "Positive": 0.07,
      "Neutral": 0.62,
      "X": -89.75907992,
      "Y": 44.89830458,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 20091,
      "County": "Johnson County, Kansas",
      "Negative": 0.48,
      "Positive": 0.24,
      "Neutral": 0.28,
      "X": -94.82245256,
      "Y": 38.88371954,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 26065,
      "County": "Ingham County, Michigan",
      "Negative": 0.42,
      "Positive": 0.04,
      "Neutral": 0.54,
      "X": -84.37341033,
      "Y": 42.59741676,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 53053,
      "County": "Pierce County, Washington",
      "Negative": 0.41,
      "Positive": 0.09,
      "Neutral": 0.5,
      "X": -122.1116449,
      "Y": 47.02665768,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 53033,
      "County": "King County, Washington",
      "Negative": 0.42,
      "Positive": 0.1,
      "Neutral": 0.48,
      "X": -121.8063555,
      "Y": 47.4900691,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 39117,
      "County": "Morrow County, Ohio",
      "Negative": 0.4,
      "Positive": 0.1,
      "Neutral": 0.5,
      "X": -82.79458727,
      "Y": 40.52405886,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 37135,
      "County": "Orange County, North Carolina",
      "Negative": 0.58,
      "Positive": 0.03,
      "Neutral": 0.39,
      "X": -79.12061873,
      "Y": 36.06120852,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 39049,
      "County": "Franklin County, Ohio",
      "Negative": 0.39,
      "Positive": 0.08,
      "Neutral": 0.52,
      "X": -83.00939698,
      "Y": 39.96963267,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 48121,
      "County": "Denton County, Texas",
      "Negative": 0.5,
      "Positive": 0.13,
      "Neutral": 0.38,
      "X": -97.11690589,
      "Y": 33.20526297,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 51540,
      "County": "Charlottesville city, Virginia",
      "Negative": 0.48,
      "Positive": 0.19,
      "Neutral": 0.32,
      "X": -78.48425514,
      "Y": 38.03777828,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 51065,
      "County": "Fluvanna County, Virginia",
      "Negative": 0.04,
      "Positive": 0.31,
      "Neutral": 0.65,
      "X": -78.27730143,
      "Y": 37.84206407,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 53037,
      "County": "Kittitas County, Washington",
      "Negative": 0.46,
      "Positive": 0.04,
      "Neutral": 0.5,
      "X": -120.6793461,
      "Y": 47.12445507,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6071,
      "County": "San Bernardino County, California",
      "Negative": 0.38,
      "Positive": 0.03,
      "Neutral": 0.6,
      "X": -116.178324,
      "Y": 34.84170453,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 8031,
      "County": "Denver County, Colorado",
      "Negative": 0.38,
      "Positive": 0.14,
      "Neutral": 0.49,
      "X": -104.8787569,
      "Y": 39.76014764,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 26137,
      "County": "Otsego County, Michigan",
      "Negative": 0.5,
      "Positive": 0,
      "Neutral": 0.5,
      "X": -84.5980357,
      "Y": 45.0209311,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 37081,
      "County": "Guilford County, North Carolina",
      "Negative": 0.34,
      "Positive": 0.03,
      "Neutral": 0.62,
      "X": -79.78880849,
      "Y": 36.0794017,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 28123,
      "County": "Scott County, Mississippi",
      "Negative": 0.38,
      "Positive": 0.13,
      "Neutral": 0.5,
      "X": -89.53780586,
      "Y": 32.4066026,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36023,
      "County": "Cortland County, New York",
      "Negative": 0.42,
      "Positive": 0.09,
      "Neutral": 0.49,
      "X": -76.07036579,
      "Y": 42.59513527,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 26081,
      "County": "Kent County, Michigan",
      "Negative": 0.39,
      "Positive": 0.1,
      "Neutral": 0.52,
      "X": -85.54934628,
      "Y": 43.03209098,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 4019,
      "County": "Pima County, Arizona",
      "Negative": 0.35,
      "Positive": 0.06,
      "Neutral": 0.59,
      "X": -111.7895315,
      "Y": 32.09746167,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 12073,
      "County": "Leon County, Florida",
      "Negative": 0.52,
      "Positive": 0.22,
      "Neutral": 0.26,
      "X": -84.27776809,
      "Y": 30.4579997,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 34021,
      "County": "Mercer County, New Jersey",
      "Negative": 0.5,
      "Positive": 0.1,
      "Neutral": 0.4,
      "X": -74.70201254,
      "Y": 40.2831026,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 42101,
      "County": "Philadelphia County, Pennsylvania",
      "Negative": 0.45,
      "Positive": 0.11,
      "Neutral": 0.45,
      "X": -75.1333858,
      "Y": 40.00805723,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 29095,
      "County": "Jackson County, Missouri",
      "Negative": 0.36,
      "Positive": 0.12,
      "Neutral": 0.52,
      "X": -94.34616783,
      "Y": 39.00843256,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 31055,
      "County": "Douglas County, Nebraska",
      "Negative": 0.49,
      "Positive": 0.03,
      "Neutral": 0.49,
      "X": -96.1549352,
      "Y": 41.29540943,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 47037,
      "County": "Davidson County, Tennessee",
      "Negative": 0.38,
      "Positive": 0.04,
      "Neutral": 0.59,
      "X": -86.78436789,
      "Y": 36.16940548,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6111,
      "County": "Ventura County, California",
      "Negative": 0.62,
      "Positive": 0.17,
      "Neutral": 0.21,
      "X": -119.0849328,
      "Y": 34.45472711,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 36081,
      "County": "Queens County, New York",
      "Negative": 0.49,
      "Positive": 0.07,
      "Neutral": 0.44,
      "X": -73.81951027,
      "Y": 40.70325321,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 24005,
      "County": "Baltimore County, Maryland",
      "Negative": 0.49,
      "Positive": 0.06,
      "Neutral": 0.45,
      "X": -76.63609785,
      "Y": 39.45965594,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 36085,
      "County": "Richmond County, New York",
      "Negative": 0.29,
      "Positive": 0,
      "Neutral": 0.71,
      "X": -74.15446143,
      "Y": 40.58130309,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36055,
      "County": "Monroe County, New York",
      "Negative": 0.33,
      "Positive": 0.09,
      "Neutral": 0.58,
      "X": -77.69599971,
      "Y": 43.14651327,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6043,
      "County": "Mariposa County, California",
      "Negative": 0.37,
      "Positive": 0.04,
      "Neutral": 0.59,
      "X": -119.9053265,
      "Y": 37.58143324,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6037,
      "County": "Los Angeles County, California",
      "Negative": 0.44,
      "Positive": 0.08,
      "Neutral": 0.48,
      "X": -118.2245573,
      "Y": 34.32131567,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 37067,
      "County": "Forsyth County, North Carolina",
      "Negative": 0.27,
      "Positive": 0.18,
      "Neutral": 0.55,
      "X": -80.2558169,
      "Y": 36.13065904,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 32003,
      "County": "Clark County, Nevada",
      "Negative": 0.38,
      "Positive": 0.08,
      "Neutral": 0.55,
      "X": -115.0145927,
      "Y": 36.21513,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 48201,
      "County": "Harris County, Texas",
      "Negative": 0.47,
      "Positive": 0.05,
      "Neutral": 0.48,
      "X": -95.39303746,
      "Y": 29.85746998,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 34007,
      "County": "Camden County, New Jersey",
      "Negative": 0.45,
      "Positive": 0.05,
      "Neutral": 0.5,
      "X": -74.9601486,
      "Y": 39.80419535,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 27123,
      "County": "Ramsey County, Minnesota",
      "Negative": 0.44,
      "Positive": 0.11,
      "Neutral": 0.45,
      "X": -93.09960884,
      "Y": 45.01726565,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 37183,
      "County": "Wake County, North Carolina",
      "Negative": 0.3,
      "Positive": 0.11,
      "Neutral": 0.58,
      "X": -78.65040405,
      "Y": 35.79018036,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 51760,
      "County": "Richmond city, Virginia",
      "Negative": 0.31,
      "Positive": 0.09,
      "Neutral": 0.6,
      "X": -77.47408764,
      "Y": 37.52946389,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6059,
      "County": "Orange County, California",
      "Negative": 0.4,
      "Positive": 0.08,
      "Neutral": 0.53,
      "X": -117.761009,
      "Y": 33.70307738,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 12103,
      "County": "Pinellas County, Florida",
      "Negative": 0.6,
      "Positive": 0.07,
      "Neutral": 0.33,
      "X": -82.73017003,
      "Y": 27.92626609,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 20173,
      "County": "Sedgwick County, Kansas",
      "Negative": 0.27,
      "Positive": 0.14,
      "Neutral": 0.59,
      "X": -97.46095777,
      "Y": 37.68480314,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 37063,
      "County": "Durham County, North Carolina",
      "Negative": 0.41,
      "Positive": 0.08,
      "Neutral": 0.52,
      "X": -78.87644684,
      "Y": 36.03592955,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 47157,
      "County": "Shelby County, Tennessee",
      "Negative": 0.31,
      "Positive": 0.1,
      "Neutral": 0.59,
      "X": -89.89574373,
      "Y": 35.18400261,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 29510,
      "County": "St. Louis city, Missouri",
      "Negative": 0.41,
      "Positive": 0.1,
      "Neutral": 0.48,
      "X": -90.24489209,
      "Y": 38.6363488,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 25025,
      "County": "Suffolk County, Massachusetts",
      "Negative": 0.33,
      "Positive": 0.13,
      "Neutral": 0.55,
      "X": -71.06924153,
      "Y": 42.33429318,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 47093,
      "County": "Knox County, Tennessee",
      "Negative": 0.3,
      "Positive": 0.18,
      "Neutral": 0.52,
      "X": -83.93730556,
      "Y": 35.99287353,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 11001,
      "County": "District of Columbia, District of Columbia",
      "Negative": 0.42,
      "Positive": 0.09,
      "Neutral": 0.5,
      "X": -77.01629654,
      "Y": 38.90478149,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 42003,
      "County": "Allegheny County, Pennsylvania",
      "Negative": 0.39,
      "Positive": 0.1,
      "Neutral": 0.51,
      "X": -79.98140535,
      "Y": 40.46891128,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 42091,
      "County": "Montgomery County, Pennsylvania",
      "Negative": 0.7,
      "Positive": 0.05,
      "Neutral": 0.25,
      "X": -75.36726315,
      "Y": 40.21070381,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 13067,
      "County": "Cobb County, Georgia",
      "Negative": 0.38,
      "Positive": 0.06,
      "Neutral": 0.56,
      "X": -84.57651015,
      "Y": 33.94160506,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 25009,
      "County": "Essex County, Massachusetts",
      "Negative": 0.38,
      "Positive": 0.08,
      "Neutral": 0.54,
      "X": -70.95148846,
      "Y": 42.67178643,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 51059,
      "County": "Fairfax County, Virginia",
      "Negative": 0.4,
      "Positive": 0.08,
      "Neutral": 0.53,
      "X": -77.27658048,
      "Y": 38.83575195,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 48439,
      "County": "Tarrant County, Texas",
      "Negative": 0.48,
      "Positive": 0.03,
      "Neutral": 0.49,
      "X": -97.2912451,
      "Y": 32.77152085,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 13319,
      "County": "Wilkinson County, Georgia",
      "Negative": 0.56,
      "Positive": 0.03,
      "Neutral": 0.41,
      "X": -83.1709176,
      "Y": 32.80273131,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 25027,
      "County": "Worcester County, Massachusetts",
      "Negative": 0.16,
      "Positive": 0.14,
      "Neutral": 0.7,
      "X": -71.90762698,
      "Y": 42.35148892,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 26099,
      "County": "Macomb County, Michigan",
      "Negative": 0.38,
      "Positive": 0,
      "Neutral": 0.62,
      "X": -82.93240192,
      "Y": 42.69600635,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 47149,
      "County": "Rutherford County, Tennessee",
      "Negative": 0.54,
      "Positive": 0.05,
      "Neutral": 0.41,
      "X": -86.4167004,
      "Y": 35.84261627,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 39061,
      "County": "Hamilton County, Ohio",
      "Negative": 0.45,
      "Positive": 0.1,
      "Neutral": 0.45,
      "X": -84.54289916,
      "Y": 39.19568159,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 17031,
      "County": "Cook County, Illinois",
      "Negative": 0.37,
      "Positive": 0.09,
      "Neutral": 0.54,
      "X": -87.81688479,
      "Y": 41.839954,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 19153,
      "County": "Polk County, Iowa",
      "Negative": 0.55,
      "Positive": 0.1,
      "Neutral": 0.35,
      "X": -93.57367014,
      "Y": 41.68565838,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 45027,
      "County": "Clarendon County, South Carolina",
      "Negative": 0.41,
      "Positive": 0.07,
      "Neutral": 0.52,
      "X": -80.21672488,
      "Y": 33.6655662,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 41067,
      "County": "Washington County, Oregon",
      "Negative": 0.36,
      "Positive": 0.16,
      "Neutral": 0.48,
      "X": -123.0980311,
      "Y": 45.55937337,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 51013,
      "County": "Arlington County, Virginia",
      "Negative": 0.44,
      "Positive": 0.12,
      "Neutral": 0.44,
      "X": -77.10119343,
      "Y": 38.87862902,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 16001,
      "County": "Ada County, Idaho",
      "Negative": 0.27,
      "Positive": 0.11,
      "Neutral": 0.62,
      "X": -116.2412687,
      "Y": 43.45089227,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 17167,
      "County": "Sangamon County, Illinois",
      "Negative": 0.55,
      "Positive": 0.06,
      "Neutral": 0.39,
      "X": -89.65885644,
      "Y": 39.75825341,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 39035,
      "County": "Cuyahoga County, Ohio",
      "Negative": 0.36,
      "Positive": 0.13,
      "Neutral": 0.52,
      "X": -81.65870818,
      "Y": 41.42427711,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 48085,
      "County": "Collin County, Texas",
      "Negative": 0.68,
      "Positive": 0.03,
      "Neutral": 0.3,
      "X": -96.57266695,
      "Y": 33.18826078,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 51109,
      "County": "Louisa County, Virginia",
      "Negative": 0.48,
      "Positive": 0.08,
      "Neutral": 0.44,
      "X": -77.96260498,
      "Y": 37.97839969,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 6001,
      "County": "Alameda County, California",
      "Negative": 0.41,
      "Positive": 0.06,
      "Neutral": 0.53,
      "X": -121.8888742,
      "Y": 37.64651553,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6013,
      "County": "Contra Costa County, California",
      "Negative": 0.47,
      "Positive": 0.11,
      "Neutral": 0.43,
      "X": -121.927614,
      "Y": 37.91932815,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 6019,
      "County": "Fresno County, California",
      "Negative": 0.38,
      "Positive": 0.05,
      "Neutral": 0.57,
      "X": -119.6484682,
      "Y": 36.75832758,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 37163,
      "County": "Sampson County, North Carolina",
      "Negative": 0.49,
      "Positive": 0.03,
      "Neutral": 0.49,
      "X": -78.37128039,
      "Y": 34.99181245,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 6077,
      "County": "San Joaquin County, California",
      "Negative": 0.33,
      "Positive": 0.24,
      "Neutral": 0.43,
      "X": -121.2711283,
      "Y": 37.93458577,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36059,
      "County": "Nassau County, New York",
      "Negative": 0.39,
      "Positive": 0.07,
      "Neutral": 0.54,
      "X": -73.58620822,
      "Y": 40.73775389,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 27053,
      "County": "Hennepin County, Minnesota",
      "Negative": 0.44,
      "Positive": 0.08,
      "Neutral": 0.48,
      "X": -93.47686682,
      "Y": 45.0046089,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 1073,
      "County": "Jefferson County, Alabama",
      "Negative": 0.43,
      "Positive": 0.13,
      "Neutral": 0.45,
      "X": -86.89630765,
      "Y": 33.55450598,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 12011,
      "County": "Broward County, Florida",
      "Negative": 0.43,
      "Positive": 0.08,
      "Neutral": 0.49,
      "X": -80.48725427,
      "Y": 26.15221765,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 41051,
      "County": "Multnomah County, Oregon",
      "Negative": 0.27,
      "Positive": 0.09,
      "Neutral": 0.64,
      "X": -122.414765,
      "Y": 45.54672413,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 24003,
      "County": "Anne Arundel County, Maryland",
      "Negative": 0.36,
      "Positive": 0.19,
      "Neutral": 0.44,
      "X": -76.60338689,
      "Y": 39.00561353,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 12086,
      "County": "Miami-Dade County, Florida",
      "Negative": 0.41,
      "Positive": 0.03,
      "Neutral": 0.56,
      "X": -80.55913218,
      "Y": 25.61518646,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 40143,
      "County": "Tulsa County, Oklahoma",
      "Negative": 0.44,
      "Positive": 0.09,
      "Neutral": 0.47,
      "X": -95.94144999,
      "Y": 36.12112623,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36103,
      "County": "Suffolk County, New York",
      "Negative": 0.3,
      "Positive": 0.09,
      "Neutral": 0.61,
      "X": -72.84432217,
      "Y": 40.87019131,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 27021,
      "County": "Cass County, Minnesota",
      "Negative": 0.36,
      "Positive": 0.09,
      "Neutral": 0.55,
      "X": -94.32644815,
      "Y": 46.94938187,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 18097,
      "County": "Marion County, Indiana",
      "Negative": 0.4,
      "Positive": 0.07,
      "Neutral": 0.53,
      "X": -86.13819561,
      "Y": 39.78174763,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 12057,
      "County": "Hillsborough County, Florida",
      "Negative": 0.35,
      "Positive": 0.15,
      "Neutral": 0.5,
      "X": -82.3086698,
      "Y": 27.92919595,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 12105,
      "County": "Polk County, Florida",
      "Negative": 0.51,
      "Positive": 0.09,
      "Neutral": 0.4,
      "X": -81.69735963,
      "Y": 27.94868037,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 34013,
      "County": "Essex County, New Jersey",
      "Negative": 0.48,
      "Positive": 0.06,
      "Neutral": 0.46,
      "X": -74.24692556,
      "Y": 40.78688639,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 10001,
      "County": "Kent County, Delaware",
      "Negative": 0.63,
      "Positive": 0,
      "Neutral": 0.37,
      "X": -75.56832149,
      "Y": 39.0861975,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 8041,
      "County": "El Paso County, Colorado",
      "Negative": 0.26,
      "Positive": 0.13,
      "Neutral": 0.61,
      "X": -104.5258302,
      "Y": 38.83217218,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 48113,
      "County": "Dallas County, Texas",
      "Negative": 0.43,
      "Positive": 0.08,
      "Neutral": 0.49,
      "X": -96.77791944,
      "Y": 32.76660316,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 26163,
      "County": "Wayne County, Michigan",
      "Negative": 0.45,
      "Positive": 0.08,
      "Neutral": 0.47,
      "X": -83.28216556,
      "Y": 42.28170513,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 55079,
      "County": "Milwaukee County, Wisconsin",
      "Negative": 0.33,
      "Positive": 0.09,
      "Neutral": 0.58,
      "X": -87.96696201,
      "Y": 43.00722951,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 44007,
      "County": "Providence County, Rhode Island",
      "Negative": 0.37,
      "Positive": 0.03,
      "Neutral": 0.6,
      "X": -71.58023251,
      "Y": 41.8723085,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 21167,
      "County": "Mercer County, Kentucky",
      "Negative": 0.61,
      "Positive": 0.06,
      "Neutral": 0.32,
      "X": -84.87455446,
      "Y": 37.8111356,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 25021,
      "County": "Norfolk County, Massachusetts",
      "Negative": 0.3,
      "Positive": 0.12,
      "Neutral": 0.58,
      "X": -71.20724993,
      "Y": 42.16243282,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 28049,
      "County": "Hinds County, Mississippi",
      "Negative": 0.36,
      "Positive": 0.04,
      "Neutral": 0.6,
      "X": -90.44276848,
      "Y": 32.26663436,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 25017,
      "County": "Middlesex County, Massachusetts",
      "Negative": 0.32,
      "Positive": 0.11,
      "Neutral": 0.57,
      "X": -71.39193741,
      "Y": 42.48554809,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6067,
      "County": "Sacramento County, California",
      "Negative": 0.32,
      "Positive": 0.07,
      "Neutral": 0.61,
      "X": -121.3445109,
      "Y": 38.44873713,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 13089,
      "County": "DeKalb County, Georgia",
      "Negative": 0.39,
      "Positive": 0.07,
      "Neutral": 0.54,
      "X": -84.22642723,
      "Y": 33.7712448,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 8013,
      "County": "Boulder County, Colorado",
      "Negative": 0.42,
      "Positive": 0.13,
      "Neutral": 0.46,
      "X": -105.357651,
      "Y": 40.09251652,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36119,
      "County": "Westchester County, New York",
      "Negative": 0.38,
      "Positive": 0.09,
      "Neutral": 0.53,
      "X": -73.75596624,
      "Y": 41.16169179,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 22051,
      "County": "Jefferson Parish, Louisiana",
      "Negative": 0.39,
      "Positive": 0.09,
      "Neutral": 0.52,
      "X": -90.11296821,
      "Y": 29.74138078,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 41005,
      "County": "Clackamas County, Oregon",
      "Negative": 0.13,
      "Positive": 0.1,
      "Neutral": 0.77,
      "X": -122.2202949,
      "Y": 45.1880165,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 9001,
      "County": "Fairfield County, Connecticut",
      "Negative": 0.33,
      "Positive": 0.11,
      "Neutral": 0.56,
      "X": -73.38906168,
      "Y": 41.26981021,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 9009,
      "County": "New Haven County, Connecticut",
      "Negative": 0.43,
      "Positive": 0.06,
      "Neutral": 0.51,
      "X": -72.93138677,
      "Y": 41.41054281,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36065,
      "County": "Oneida County, New York",
      "Negative": 0.53,
      "Positive": 0.03,
      "Neutral": 0.44,
      "X": -75.43569021,
      "Y": 43.24176944,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 13121,
      "County": "Fulton County, Georgia",
      "Negative": 0.35,
      "Positive": 0.1,
      "Neutral": 0.55,
      "X": -84.46672004,
      "Y": 33.79016254,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 8059,
      "County": "Jefferson County, Colorado",
      "Negative": 0.15,
      "Positive": 0.05,
      "Neutral": 0.8,
      "X": -105.250857,
      "Y": 39.58633806,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 21111,
      "County": "Jefferson County, Kentucky",
      "Negative": 0.38,
      "Positive": 0.1,
      "Neutral": 0.52,
      "X": -85.65932816,
      "Y": 38.1872921,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 29131,
      "County": "Miller County, Missouri",
      "Negative": 0.38,
      "Positive": 0.13,
      "Neutral": 0.5,
      "X": -92.4281826,
      "Y": 38.2146999,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 23005,
      "County": "Cumberland County, Maine",
      "Negative": 0.3,
      "Positive": 0.1,
      "Neutral": 0.6,
      "X": -70.37597137,
      "Y": 43.83828922,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 22071,
      "County": "Orleans Parish, Louisiana",
      "Negative": 0.39,
      "Positive": 0.06,
      "Neutral": 0.55,
      "X": -89.92835776,
      "Y": 30.06884178,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 49035,
      "County": "Salt Lake County, Utah",
      "Negative": 0.47,
      "Positive": 0.04,
      "Neutral": 0.49,
      "X": -111.9237006,
      "Y": 40.66671871,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 26161,
      "County": "Washtenaw County, Michigan",
      "Negative": 0.37,
      "Positive": 0.11,
      "Neutral": 0.53,
      "X": -83.83851181,
      "Y": 42.25282544,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 17043,
      "County": "DuPage County, Illinois",
      "Negative": 0.31,
      "Positive": 0.14,
      "Neutral": 0.55,
      "X": -88.08560458,
      "Y": 41.85196015,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 9003,
      "County": "Hartford County, Connecticut",
      "Negative": 0.46,
      "Positive": 0.05,
      "Neutral": 0.49,
      "X": -72.73286489,
      "Y": 41.80640818,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 24033,
      "County": "Prince George's County, Maryland",
      "Negative": 0.52,
      "Positive": 0.05,
      "Neutral": 0.44,
      "X": -76.84705042,
      "Y": 38.82986856,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 40027,
      "County": "Cleveland County, Oklahoma",
      "Negative": 0.28,
      "Positive": 0.12,
      "Neutral": 0.6,
      "X": -97.32668126,
      "Y": 35.20318093,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36005,
      "County": "Bronx County, New York",
      "Negative": 0.37,
      "Positive": 0.09,
      "Neutral": 0.54,
      "X": -73.86178888,
      "Y": 40.85051431,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6073,
      "County": "San Diego County, California",
      "Negative": 0.39,
      "Positive": 0.12,
      "Neutral": 0.49,
      "X": -116.7354708,
      "Y": 33.03388222,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 24510,
      "County": "Baltimore city, Maryland",
      "Negative": 0.41,
      "Positive": 0.07,
      "Neutral": 0.52,
      "X": -76.61438566,
      "Y": 39.30512501,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 46027,
      "County": "Clay County, South Dakota",
      "Negative": 0,
      "Positive": 0.3,
      "Neutral": 0.7,
      "X": -96.9756042,
      "Y": 42.91462032,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6065,
      "County": "Riverside County, California",
      "Negative": 0.56,
      "Positive": 0.08,
      "Neutral": 0.37,
      "X": -115.9940643,
      "Y": 33.74340112,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 5119,
      "County": "Pulaski County, Arkansas",
      "Negative": 0.45,
      "Positive": 0.04,
      "Neutral": 0.51,
      "X": -92.31182672,
      "Y": 34.7700434,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6085,
      "County": "Santa Clara County, California",
      "Negative": 0.42,
      "Positive": 0.14,
      "Neutral": 0.44,
      "X": -121.6948939,
      "Y": 37.23183219,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36029,
      "County": "Erie County, New York",
      "Negative": 0.43,
      "Positive": 0.03,
      "Neutral": 0.54,
      "X": -78.73250016,
      "Y": 42.76389483,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 37119,
      "County": "Mecklenburg County, North Carolina",
      "Negative": 0.31,
      "Positive": 0.09,
      "Neutral": 0.6,
      "X": -80.83280517,
      "Y": 35.24680328,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 39113,
      "County": "Montgomery County, Ohio",
      "Negative": 0.31,
      "Positive": 0.07,
      "Neutral": 0.62,
      "X": -84.29053728,
      "Y": 39.75453194,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 34025,
      "County": "Monmouth County, New Jersey",
      "Negative": 0.44,
      "Positive": 0.04,
      "Neutral": 0.52,
      "X": -74.22058169,
      "Y": 40.260653,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36047,
      "County": "Kings County, New York",
      "Negative": 0.44,
      "Positive": 0.07,
      "Neutral": 0.49,
      "X": -73.93855282,
      "Y": 40.63976222,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 35001,
      "County": "Bernalillo County, New Mexico",
      "Negative": 0.44,
      "Positive": 0.05,
      "Neutral": 0.51,
      "X": -106.6704981,
      "Y": 35.0513833,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 48453,
      "County": "Travis County, Texas",
      "Negative": 0.47,
      "Positive": 0.08,
      "Neutral": 0.45,
      "X": -97.78157025,
      "Y": 30.33464827,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 8093,
      "County": "Park County, Colorado",
      "Negative": 0.5,
      "Positive": 0.05,
      "Neutral": 0.45,
      "X": -105.7173124,
      "Y": 39.11969455,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 26125,
      "County": "Oakland County, Michigan",
      "Negative": 0.5,
      "Positive": 0.05,
      "Neutral": 0.45,
      "X": -83.38572258,
      "Y": 42.66036933,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 13059,
      "County": "Clarke County, Georgia",
      "Negative": 0.29,
      "Positive": 0.17,
      "Neutral": 0.54,
      "X": -83.36681274,
      "Y": 33.95113623,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 6081,
      "County": "San Mateo County, California",
      "Negative": 0.52,
      "Positive": 0.04,
      "Neutral": 0.44,
      "X": -122.3289061,
      "Y": 37.4229783,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 34023,
      "County": "Middlesex County, New Jersey",
      "Negative": 0.33,
      "Positive": 0.21,
      "Neutral": 0.46,
      "X": -74.41114638,
      "Y": 40.43913361,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 40109,
      "County": "Oklahoma County, Oklahoma",
      "Negative": 0.21,
      "Positive": 0.06,
      "Neutral": 0.73,
      "X": -97.40725148,
      "Y": 35.55149577,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 4013,
      "County": "Maricopa County, Arizona",
      "Negative": 0.46,
      "Positive": 0.11,
      "Neutral": 0.43,
      "X": -112.4910154,
      "Y": 33.34869945,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 34029,
      "County": "Ocean County, New Jersey",
      "Negative": 0.47,
      "Positive": 0.06,
      "Neutral": 0.47,
      "X": -74.28147192,
      "Y": 39.88495409,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 6075,
      "County": "San Francisco County, California",
      "Negative": 0.41,
      "Positive": 0.08,
      "Neutral": 0.5,
      "X": -122.43967,
      "Y": 37.75668005,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 12099,
      "County": "Palm Beach County, Florida",
      "Negative": 0.43,
      "Positive": 0.08,
      "Neutral": 0.49,
      "X": -80.4652681,
      "Y": 26.64755642,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 29189,
      "County": "St. Louis County, Missouri",
      "Negative": 0.43,
      "Positive": 0.05,
      "Neutral": 0.51,
      "X": -90.44298242,
      "Y": 38.64023955,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 24031,
      "County": "Montgomery County, Maryland",
      "Negative": 0.43,
      "Positive": 0.05,
      "Neutral": 0.52,
      "X": -77.20434575,
      "Y": 39.13640572,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 42035,
      "County": "Clinton County, Pennsylvania",
      "Negative": 0.45,
      "Positive": 0.09,
      "Neutral": 0.46,
      "X": -77.63797904,
      "Y": 41.2339992,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 51710,
      "County": "Norfolk city, Virginia",
      "Negative": 0.28,
      "Positive": 0.13,
      "Neutral": 0.59,
      "X": -76.25906103,
      "Y": 36.89452974,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 34017,
      "County": "Hudson County, New Jersey",
      "Negative": 0.44,
      "Positive": 0.09,
      "Neutral": 0.47,
      "X": -74.07743377,
      "Y": 40.73575683,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 12095,
      "County": "Orange County, Florida",
      "Negative": 0.59,
      "Positive": 0.02,
      "Neutral": 0.39,
      "X": -81.32373216,
      "Y": 28.51436551,
      "Sentiment": "Negative"
    },
    {
      "FIPS": 36061,
      "County": "New York County, New York",
      "Negative": 0.36,
      "Positive": 0.07,
      "Neutral": 0.57,
      "X": -73.97144003,
      "Y": 40.77217572,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 48157,
      "County": "Fort Bend County, Texas",
      "Negative": 0.38,
      "Positive": 0.09,
      "Neutral": 0.53,
      "X": -95.77085346,
      "Y": 29.52754977,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 36067,
      "County": "Onondaga County, New York",
      "Negative": 0.43,
      "Positive": 0.1,
      "Neutral": 0.48,
      "X": -76.19446979,
      "Y": 43.00600126,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 48029,
      "County": "Bexar County, Texas",
      "Negative": 0.38,
      "Positive": 0.13,
      "Neutral": 0.49,
      "X": -98.51974877,
      "Y": 29.44905658,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 20159,
      "County": "Rice County, Kansas",
      "Negative": 0.25,
      "Positive": 0.1,
      "Neutral": 0.65,
      "X": -98.20088429,
      "Y": 38.34722249,
      "Sentiment": "Neutral"
    },
    {
      "FIPS": 22033,
      "County": "East Baton Rouge Parish, Louisiana",
      "Negative": 0.41,
      "Positive": 0,
      "Neutral": 0.59,
      "X": -91.09575051,
      "Y": 30.53838878,
      "Sentiment": "Neutral"
    }
    ];

    let filteredData = [...data]; // Keeps a copy of the filtered data
    const markers = {}; // To store markers for each county by its county name

    // Filter Function
    function filterData() {
      const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
      filteredData = data.filter(d => d.County.toLowerCase().includes(searchTerm));
      populateTable(filteredData);
      updateMapMarkers(filteredData);
    }

    // Update table based on filtered data
    function populateTable(dataToDisplay) {
      const tableBody = document.getElementById('data-table-body');
      tableBody.innerHTML = ''; // Clear current table body
      dataToDisplay.forEach(d => {
        const row = `<tr data-county="${d.County}">
          <td>${d.County}</td>
          <td>${d.Negative}</td>
          <td>${d.Positive}</td>
          <td>${d.Neutral}</td>
        </tr>`;
        tableBody.insertAdjacentHTML('beforeend', row);
      });
    }

    // Update map markers based on filtered data
    function updateMapMarkers(filteredData) {
      map.eachLayer(layer => {
        if (layer instanceof L.CircleMarker) {
          map.removeLayer(layer);
        }
      });

      filteredData.forEach(d => {
        const marker = L.circleMarker([d.Y, d.X], {
          radius: 8,
          fillColor: d.Sentiment === 'Positive' ? 'green' : d.Sentiment === 'Negative' ? 'red' : 'yellow',
          color: 'white',
          weight: 1,
          fillOpacity: 0.8
        }).addTo(map);

        // Store marker by county name
        markers[d.County] = marker;

        marker.bindPopup(`${d.County}<br/>Negative: ${d.Negative}`);
      });
    }

    const sentimentCounts = data.reduce((counts, d) => {
  counts.Negative = (counts.Negative || 0) + d.Negative;
  counts.Positive = (counts.Positive || 0) + d.Positive;
  counts.Neutral = (counts.Neutral || 0) + d.Neutral;
  return counts;
}, {});

// Calculate average by dividing the sum by number of entries
sentimentCounts.Negative /= data.length;
sentimentCounts.Positive /= data.length;
sentimentCounts.Neutral /= data.length;


const pieCtx = document.getElementById('sentimentPieChart').getContext('2d');
new Chart(pieCtx, {
  type: 'pie',
  data: {
    labels: ['Negative', 'Positive', 'Neutral'],
    datasets: [{
      label: 'Average percentage',
      data: [sentimentCounts.Negative, sentimentCounts.Positive, sentimentCounts.Neutral],
      backgroundColor: ['#FF0000', '#00FF00', '#FFFF00']
    }]
  },
  options: {
    plugins: {
      title: {
        display: true,
        text: 'Average percentage of each sentiment among all counties'
      },
      legend: {
        position: 'left' // Optional: move legend below chart
      }
    }
  }
});


    const ranges = [0, 0.2, 0.4, 0.6, 0.8, 1];
    const rangeLabels = ranges.slice(0, -1).map((start, i) => `${start} - ${ranges[i + 1]}`);
    const rangeCounts = ranges.slice(0, -1).map((start, i) =>
      data.filter(d => d.Negative >= start && d.Negative < ranges[i + 1]).length
    );

    const barCtx = document.getElementById('negativeBarChart').getContext('2d');
new Chart(barCtx, {
  type: 'bar',
  data: {
    labels: rangeLabels,
    datasets: [{
      label: 'Number of counties with different percentage of negative sentiment',
      data: rangeCounts,
      backgroundColor: '#FF0000'
    }]
  },
  options: {
    scales: {
      x: {
        title: {
          display: true,
          text: 'Negative sentiment percentage range'
        }
      },
      y: {
        beginAtZero: true,
        title: {
          display: true,
          text: 'Number of counties'
        }
      }
    }
  }
});
    const map = L.map('map').setView([35, -95], 4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Initialize the map with all markers
    updateMapMarkers(data);

    // Initialize table with all data
    populateTable(data);
    function populateTable(dataToDisplay) {
  const tableBody = document.getElementById('data-table-body');
  tableBody.innerHTML = ''; // Clear current table body

  dataToDisplay.forEach(d => {
    const row = document.createElement('tr');
    row.setAttribute('data-county', d.County);
    row.innerHTML = `
      <td>${d.County}</td>
      <td>${d.Negative}</td>
      <td>${d.Positive}</td>
      <td>${d.Neutral}</td>
    `;

    // ✅ Attach the click event listener here
    row.addEventListener('click', function () {
      const countyName = this.getAttribute('data-county');
      const marker = markers[countyName];
      if (marker) {
        map.setView(marker.getLatLng(), 10);
        marker.openPopup();
      }
    });

    tableBody.appendChild(row);
  });
}

    // // Add click event on rows to zoom and center map marker
    // document.querySelectorAll('#data-table-body tr').forEach(row => {
    //   row.addEventListener('click', function() {
    //     const countyName = this.getAttribute('data-county');
    //     const marker = markers[countyName];
        
    //     if (marker) {
    //       map.setView(marker.getLatLng(), 10);  // Zoom in and center the map on the marker
    //       marker.openPopup();  // Open the marker's popup
    //     }
    //   });
    // });

    // Table Sorting (existing functionality)
    document.querySelectorAll('th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const key = th.dataset.sort;
        const sorted = [...filteredData].sort((a, b) => {
          if (typeof a[key] === 'string') {
            return a[key].localeCompare(b[key]);
          } else {
            return b[key] - a[key]; // Descending for numbers
          }
        });
        populateTable(sorted);
        updateMapMarkers(sorted); // Update map markers after sorting
      });
    });

    // About Modal Functionality
    const modal = document.getElementById('aboutModal');
    const btn = document.getElementById('about-button');
    const span = document.querySelector('.modal .close');
    btn.onclick = () => modal.style.display = "block";
    span.onclick = () => modal.style.display = "none";
    window.onclick = (e) => {
      if (e.target === modal) modal.style.display = "none";
    };
  </script>
</body>
</html>
